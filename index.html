<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Atrium Display – Versailles UMC</title>

<style>
  :root{ --rule:#e5e7eb; --yellow:#f8cf1b; --footer:#bfe5ef; --text:#0b0e14; }
  html,body{height:100%}
  body{
    margin:0; background:#fff; color:var(--text);
    font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    display:grid; grid-template-rows:auto 1fr auto auto; grid-template-columns:1fr 1fr; height:100vh;
  }

  /* Top bar */
  header{grid-column:1/3; background:#fff; padding:14px 20px; font-weight:800; font-size:clamp(20px,2.6vw,34px)}

  /* Main panels */
  .left{grid-row:2; grid-column:1; background:transparent;} /* FreeShow NDI goes over this */
  .right{
    grid-row:2; grid-column:2; background:var(--yellow); display:flex; flex-direction:column;
    border-left:1px solid var(--rule);
  }
  .panel{display:flex; flex-direction:column; height:100%}
  .panel-header{background:#c62828; color:#fff; padding:10px 14px; font-weight:800; font-size:clamp(16px,2vw,22px)}
  .vwrap{position:relative; overflow:hidden; flex:1; background:#fff}
  .vscroll{position:absolute; inset:0; overflow:auto; scroll-behavior:smooth; padding:10px 14px}
  .vscroll::-webkit-scrollbar{width:0;height:0}

  /* QR band */
  .qr{
    grid-row:3; grid-column:1/3; background:#fff; padding:18px 24px; display:flex;
    align-items:center; justify-content:center; gap:20px; border-top:1px solid var(--rule);
  }
  .qr-card{display:flex; align-items:center; gap:16px}
  .qr-card .text{font-weight:800; font-size:clamp(18px,2.2vw,28px)}
  .qr-card .url{font-weight:800; text-decoration:underline}

  /* Weather footer */
  footer{grid-row:4; grid-column:1/3; background:var(--footer); padding:10px 14px; border-top:1px solid var(--rule)}
  .wx{display:flex; align-items:center; gap:16px; flex-wrap:wrap}
  .wx .current{display:flex; align-items:center; gap:8px; font-weight:800}
  .wx .badge{background:rgba(0,0,0,.07); padding:4px 8px; border-radius:999px; font-size:13px}
  .wx .strip{display:flex; gap:12px; align-items:flex-end}
  .wx .day{display:grid; grid-template-rows:auto auto auto; gap:2px; justify-items:center}
  .wx .icon{font-size:20px}
  .wx .lo{opacity:.7; font-size:12px}

  /* Responsive (stack on narrow) */
  @media (max-aspect-ratio:4/3){
    body{grid-template-columns:1fr; grid-template-rows:auto auto auto auto 1fr auto}
    .left{grid-row:2; grid-column:1; height:40vh}
    .right{grid-row:3; grid-column:1; height:40vh}
    .qr{grid-row:4; grid-column:1}
    footer{grid-row:5; grid-column:1}
  }
</style>
</head>
<body>
  <header>Welcome to Versailles UMC</header>

  <!-- LEFT: leave blank; FreeShow will overlay NDI video & audio here -->
  <section class="left" aria-label="NDI zone (overlay from FreeShow)"></section>

  <!-- RIGHT: Scrolling calendar (Church Center embed) -->
  <section class="right">
    <div class="panel">
      <div class="panel-header">Scrolling Calendar</div>
      <div class="vwrap">
        <div class="vscroll" id="cal">
          <!-- Church Center / Planning Center Calendar embed (list view) -->
          <div id="pco-embed" style="min-height:100%;">
            <script src="https://versaillesumc.churchcenter.com/assets/calendar_embed.js"
                    data-view="list"
                    data-height="auto"></script>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- QR band -->
  <section class="qr">
    <div class="qr-card">
      <canvas id="qr" width="140" height="140"></canvas>
      <div>
        <div class="text">Scan to open VUMC Connect</div>
        <div class="url">vumc.versaillesumc.org</div>
      </div>
    </div>
  </section>

  <!-- Weather footer -->
  <footer>
    <div class="wx" id="wx">
      <div class="current">
        <span id="wxIcon">⛅</span>
        <span id="wxTemp">--°F</span>
        <span id="wxCond">Loading…</span>
        <span class="badge">Versailles, KY</span>
      </div>
      <div class="strip" id="wxStrip" aria-label="7-day forecast"></div>
    </div>
  </footer>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

  <script>
    /* QR */
    new QRious({ element: document.getElementById('qr'), value: 'https://vumc.versaillesumc.org', size: 140, level: 'H' });

    /* Gentle auto-scroll for the calendar list */
    (function(){
      const el = document.getElementById('cal');
      let dir = 1;
      function step(){
        if (!el) return;
        const max = el.scrollHeight - el.clientHeight;
        if (el.scrollTop >= max - 2) dir = -1;
        if (el.scrollTop <= 2) dir = 1;
        el.scrollTop += dir * 0.6;  // raise for faster, lower for slower
        requestAnimationFrame(step);
      }
      step();
    })();

    /* Weather (Open-Meteo) — Versailles, KY */
    const WXCONF = { lat: 38.052, lon: -84.729 };
    const WEMOJI = c => (
      [0].includes(c)?'☀️':[1,2].includes(c)?'⛅':[3].includes(c)?'☁️':
      [45,48].includes(c)?'🌫️':[51,53,55].includes(c)?'🌦️':
      [61,63,65].includes(c)?'🌧️':[66,67].includes(c)?'🌧️❄️':
      [71,73,75,77].includes(c)?'❄️':[80,81,82].includes(c)?'🌧️':
      [85,86].includes(c)?'🌨️':[95,96,99].includes(c)?'⛈️':'🌡️'
    );
    const WLABEL = c => ({0:'Clear',1:'Mostly Sunny',2:'Partly Cloudy',3:'Cloudy',45:'Fog',48:'Freezing Fog',51:'Light Drizzle',53:'Drizzle',55:'Heavy Drizzle',61:'Light Rain',63:'Rain',65:'Heavy Rain',66:'Freezing Rain',67:'Freezing Rain',71:'Light Snow',73:'Snow',75:'Heavy Snow',77:'Snow Grains',80:'Rain Showers',81:'Rain Showers',82:'Heavy Showers',85:'Snow Showers',86:'Snow Showers',95:'Thunderstorms',96:'T’storms',99:'T’storms'})[c]||'—';

    async function loadWeather(){
      const base='https://api.open-meteo.com/v1/forecast';
      const p=new URLSearchParams({
        latitude: WXCONF.lat, longitude: WXCONF.lon,
        current_weather:'true',
        daily:'weathercode,temperature_2m_max,temperature_2m_min',
        temperature_unit:'fahrenheit',
        wind_speed_unit:'mph',
        timezone:'auto',
        forecast_days:'7'
      });
      try{
        const r = await fetch(base+'?'+p.toString(), { cache:'no-store' });
        const j = await r.json();
        const cur=j.current_weather;
        document.getElementById('wxIcon').textContent = WEMOJI(cur.weathercode);
        document.getElementById('wxTemp').textContent = Math.round(cur.temperature)+'°F';
        document.getElementById('wxCond').textContent = WLABEL(cur.weathercode);

        const days=j.daily.time, codes=j.daily.weathercode, hi=j.daily.temperature_2m_max, lo=j.daily.temperature_2m_min;
        const strip=document.getElementById('wxStrip'); strip.innerHTML='';
        for(let i=0;i<days.length;i++){
          const dt=new Date(days[i]);
          const lbl=new Intl.DateTimeFormat('en-US',{weekday:'short'}).format(dt);
          const el=document.createElement('div'); el.className='day';
          el.innerHTML = `
            <div class="lbl">${lbl}</div>
            <div class="icon">${WEMOJI(codes[i])}</div>
            <div class="hi">${Math.round(hi[i])}°</div>
            <div class="lo">${Math.round(lo[i])}°</div>
          `;
          strip.appendChild(el);
        }
      }catch(e){
        document.getElementById('wxCond').textContent = 'Weather unavailable';
      }
    }
    loadWeather();
    setInterval(loadWeather, 15*60*1000);
  </script>
</body>
</html>
